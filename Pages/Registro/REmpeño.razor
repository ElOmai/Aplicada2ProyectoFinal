@page "/Registro/Empeños"
@page "/Registro/Empeños/{EmpeñoId:int}"
@inject IToastService toastService

@code {
    [Parameter]
    public int EmpeñoId { get; set; }

    public Empeños Empeño { get; set; }

    EmpeñosController empeñoscontroller = new EmpeñosController();

    Articulos Articulo { get; set; }
    ArticulosController articulosController = new ArticulosController();
    List<Articulos> ListadoArticulos = new List<Articulos>();

    int Cantidad = 0;
    string Mensaje = string.Empty;
    string ArticuloSeleccionado = "0";

    protected override void OnInitialized()
    {
        ListadoArticulos = articulosController.GetList(e => true);
        Empeño = new Empeños();
        Articulo = new Articulos();

        if (EmpeñoId != 0)
        {
            Empeño.EmpeñoId = EmpeñoId;
            Buscar();
        }
    }
    public void Guardar()
    {

        if (Empeño.Detalle.Count <= 0)
        {
            Mensaje = "Debe ingresar algun articulo al empeño.";
        }
        else
        {
            if (empeñoscontroller.Guardar(Empeño))
            {
                Limpiar();
                toastService.ShowSuccess("Empeño guardado correctamente", "Exito");

            }
            else
            {
                toastService.ShowError("Error al guardar el Empeño", "Fallo");
            }
        }
    }
    public void Buscar()
    {
        Empeños EmpeñoTemporal = empeñoscontroller.Buscar(Empeño.EmpeñoId);

        if (EmpeñoTemporal != null)
        {
            Limpiar();
            Empeño = EmpeñoTemporal;
            toastService.ShowSuccess("Empeño encontrado.", "Exito");

        }
        else
        {
            Limpiar();
            toastService.ShowError("El empeño no fue encontrada.", "Fallo");

        }
    }
    public void Eliminar()
    {
        Empeños EmpeñoTemporal = empeñoscontroller.Buscar(Empeño.EmpeñoId);

        if (EmpeñoTemporal != null)
        {
            if (empeñoscontroller.Eliminar(Empeño.EmpeñoId))
            {
                Limpiar();
                toastService.ShowSuccess("Empeño eliminado correctamente.", "Exito");
            }
            else
            {
                toastService.ShowError("Error al eliminar el empeño.", "Fallo");
            }
        }
    }

    public void Limpiar()
    {
        this.Empeño = new Empeños();
        ArticuloSeleccionado = "0";
        Cantidad = 0;
        LimpiarMensajes();
    }

    public void LimpiarMensajes()
    {
        Mensaje = string.Empty;
    }

    
}